<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="记录生活点滴">
    

    <!--Author-->
    
        <meta name="author" content="Enstein">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="最后的板子——数据结构篇">
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="记录生活点滴">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Einstein&#39;Blog">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>最后的板子——数据结构篇 - Einstein&#39;Blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-128896598-1', 'auto');
        ga('send', 'pageview');

    </script>



</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/friends">
                    Friends
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-xing" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2018/11/07/最后的板子——数据结构篇/">
                最后的板子——数据结构篇
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-11-07</span>
            
            
                <a href="#disqus_thread" class="comments">留言</a>
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><h3 id="这个是数据结构模板。"><a href="#这个是数据结构模板。" class="headerlink" title="这个是数据结构模板。"></a>这个是数据结构模板。</h3><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h3 id="数据结构，你值得拥有。"><a href="#数据结构，你值得拥有。" class="headerlink" title="数据结构，你值得拥有。"></a>数据结构，你值得拥有。</h3><h2 id="1-基础数据结构："><a href="#1-基础数据结构：" class="headerlink" title="$1.$ 基础数据结构："></a>$1.$ 基础数据结构：</h2><h3 id="1-1-栈："><a href="#1-1-栈：" class="headerlink" title="$1.1$ 栈："></a>$1.1$ 栈：</h3><p>一般用 $STL$ 的 $stack$。</p>
<h3 id="1-2-单调栈：-伪代码来源：这里"><a href="#1-2-单调栈：-伪代码来源：这里" class="headerlink" title="$1.2$ 单调栈：(伪代码来源：这里)"></a>$1.2$ 单调栈：(伪代码来源：<a href="https://blog.csdn.net/zuzhiang/article/details/78134247" target="_blank" rel="noopener">这里</a>)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(栈为空) 栈顶元素出栈; <span class="comment">//先清空栈</span></span><br><span class="line">a[n]=<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">	<span class="keyword">if</span>(栈为空或入栈元素大于等于栈顶元素) 入栈;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(栈非空并且栈顶元素大于等于入栈元素)&#123;</span><br><span class="line">			栈顶元素出栈;</span><br><span class="line">			更新结果; </span><br><span class="line">		&#125; </span><br><span class="line">		将最后一次出栈的栈顶元素（即当前元素可以拓展到的位置）入栈; </span><br><span class="line">		更新最后一次出栈的栈顶元素其对应的值; </span><br><span class="line">	&#125; 	 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-队列："><a href="#1-3-队列：" class="headerlink" title="$1.3$ 队列："></a>$1.3$ 队列：</h3><p>一般用 $STL$ 的 $deque$ 与 $queue$。</p>
<h3 id="1-4-单调队列：-代码来源：这里"><a href="#1-4-单调队列：-代码来源：这里" class="headerlink" title="$1.4$ 单调队列：(代码来源：这里)"></a>$1.4$ 单调队列：(代码来源：<a href="https://sweetlemon.blog.luogu.org/dan-diao-dui-lie" target="_blank" rel="noopener">这里</a>)</h3><h4 id="1-4-1-deque-实现："><a href="#1-4-1-deque-实现：" class="headerlink" title="$1.4.1$ $deque$ 实现："></a>$1.4.1$ $deque$ 实现：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">    <span class="comment">//先输出数a[i]前的最小值</span></span><br><span class="line">    <span class="keyword">if</span> (q.empty()) <span class="comment">//q空，即a[i]前没有元素</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="comment">//否则判断队头是否需要出队并输出范围内的队头</span></span><br><span class="line">        <span class="keyword">if</span> (q.front().index+m&lt;i) <span class="comment">//队头已经超出滑动窗口范围</span></span><br><span class="line">            q.pop_front(); <span class="comment">// 弹出队头</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,q.front().x); <span class="comment">//此时队一定非空，这不是废话吗</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ((!q.empty()) &amp;&amp; q.back().x&gt;=a[i]) </span><br><span class="line">        <span class="comment">//当队列非空时，不断弹出队尾比当前元素大的元素</span></span><br><span class="line">        q.pop_back();</span><br><span class="line">    t.index=i;</span><br><span class="line">    t.x=a[i];</span><br><span class="line">    q.push_back(t);<span class="comment">//将当前元素入队</span></span><br><span class="line">    <span class="comment">//注意：当前元素无论如何都会入队，显然可见</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-4-2-数组实现：-用两个变量表示队头与队尾"><a href="#1-4-2-数组实现：-用两个变量表示队头与队尾" class="headerlink" title="$1.4.2$ 数组实现：(用两个变量表示队头与队尾)"></a>$1.4.2$ 数组实现：(用两个变量表示队头与队尾)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">front=<span class="number">1</span>;</span><br><span class="line">back=<span class="number">0</span>;<span class="comment">//初始化队头队尾位置，队头&gt;队尾表示队空</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="comment">//先输出数a[i]前的最小值</span></span><br><span class="line">    <span class="keyword">if</span> (front&gt;back) <span class="comment">//q空，即a[i]前没有元素</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="comment">//否则判断队头是否需要出队并输出范围内的队头</span></span><br><span class="line">        <span class="keyword">if</span> (q[front].index+m&lt;i) <span class="comment">//队头已经超出滑动窗口范围</span></span><br><span class="line">        front++; <span class="comment">// 弹出队头</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,q[front].x); <span class="comment">//此时队一定非空</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (front&lt;=back &amp;&amp; q[back].x&gt;=a[i]) </span><br><span class="line">    <span class="comment">//当队列非空时，不断弹出队尾比当前元素大的元素</span></span><br><span class="line">    	back--;</span><br><span class="line">    back++;</span><br><span class="line">    q[back].x=a[i];</span><br><span class="line">    q[back].index=i;<span class="comment">//将当前元素入队</span></span><br><span class="line">    <span class="comment">//注意：当前元素无论如何都会入队</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-hash-："><a href="#1-5-hash-：" class="headerlink" title="$1.5$ $hash$："></a>$1.5$ $hash$：</h3><p>一般用 $STL$ 中的 $map$。</p>
<h3 id="1-6-字符串-hash"><a href="#1-6-字符串-hash" class="headerlink" title="$1.6$ 字符串 $hash$:"></a>$1.6$ 字符串 $hash$:</h3><p> 找个偏移值，一般可以为 $133$ 或 $13333$ 等。</p>
<h3 id="1-7-字符串匹配："><a href="#1-7-字符串匹配：" class="headerlink" title="$1.7$ 字符串匹配："></a>$1.7$ 字符串匹配：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_next</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">char</span> a[])</span></span>&#123;</span><br><span class="line">    nex[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>,j=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(j&gt;<span class="number">0</span>&amp;&amp;a[i]!=a[j+<span class="number">1</span>]) j=nex[j];</span><br><span class="line">        <span class="keyword">if</span>(a[i]==a[j+<span class="number">1</span>]) j++;</span><br><span class="line">        nex[i]=j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">kmp</span><span class="params">(<span class="keyword">int</span> a[],<span class="keyword">int</span> b[])</span></span>&#123;</span><br><span class="line">    j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=<span class="built_in">strlen</span>(a);i++)&#123;</span><br><span class="line">          <span class="keyword">while</span>(j&gt;<span class="number">0</span>&amp;&amp;b[j+<span class="number">1</span>]!=a[i]) j=kmp[j];</span><br><span class="line">          <span class="keyword">if</span>(a[i]==b[j+<span class="number">1</span>]) j++;</span><br><span class="line">          <span class="keyword">if</span>(j==<span class="built_in">strlen</span>(b))&#123;</span><br><span class="line">              <span class="built_in">cout</span>&lt;&lt;i-<span class="built_in">strlen</span>(b)+<span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">              j=nex[j];</span><br><span class="line">          &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-堆："><a href="#1-8-堆：" class="headerlink" title="$1.8$ 堆："></a>$1.8$ 堆：</h3><p>一般用 $STL$ 的 $priority$_$queue$。</p>
<h3 id="1-9-Trie-树："><a href="#1-9-Trie-树：" class="headerlink" title="$1.9$ $Trie$ 树："></a>$1.9$ $Trie$ 树：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">char</span> a[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(a);</span><br><span class="line">    <span class="keyword">int</span> root=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> cc=a[i]-<span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span>(trie[root][cc]==<span class="number">0</span>) trie[root][cc]=++tot;</span><br><span class="line">        root=trie[root][cc];</span><br><span class="line">    &#125;</span><br><span class="line">    flag[root]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">char</span> a[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(a);</span><br><span class="line">    <span class="keyword">int</span> root=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        root=trie[root][a[i]-<span class="string">'0'</span>];</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flag[root];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-树："><a href="#1-10-树：" class="headerlink" title="$1.10$ 树："></a>$1.10$ 树：</h3><h4 id="1-10-1-树的存储方式："><a href="#1-10-1-树的存储方式：" class="headerlink" title="$1.10.1$ 树的存储方式："></a>$1.10.1$ 树的存储方式：</h4><ul>
<li>假装是图，用链式前向星存</li>
<li>二叉树存储(不是二叉树转成二叉树)</li>
<li>孩子兄弟表示法</li>
<li>。。。。。。</li>
</ul>
<h4 id="1-10-2-树的-dfs-序："><a href="#1-10-2-树的-dfs-序：" class="headerlink" title="$1.10.2$ 树的 $dfs$ 序："></a>$1.10.2$ 树的 $dfs$ 序：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    a[++k]=x;</span><br><span class="line">    vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[x];i;i=t[i].nex)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=t[i].to;</span><br><span class="line">        <span class="keyword">if</span>(vis[v]) <span class="keyword">continue</span>;</span><br><span class="line">        dfs(v);</span><br><span class="line">    &#125;</span><br><span class="line">    a[++k]=x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-10-3-树的深度："><a href="#1-10-3-树的深度：" class="headerlink" title="$1.10.3$ 树的深度："></a>$1.10.3$ 树的深度：</h4><p>略。</p>
<h4 id="1-10-4-树的重心：-点分治要用"><a href="#1-10-4-树的重心：-点分治要用" class="headerlink" title="$1.10.4$ 树的重心：(点分治要用)"></a>$1.10.4$ 树的重心：(点分治要用)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    vis[x]=<span class="number">1</span>;size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> maxx=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[x];i;i=t[i].nex)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=t[i].to;</span><br><span class="line">        <span class="keyword">if</span>(vis[v]) <span class="keyword">continue</span>;</span><br><span class="line">        dfs(v);</span><br><span class="line">        size[x]+=size[v];</span><br><span class="line">        maxx=max(maxx,size[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    maxx=max(maxx,n-size[x]);</span><br><span class="line">    <span class="keyword">if</span>(maxx&lt;ans)&#123;</span><br><span class="line">        ans=maxx;</span><br><span class="line">        pos=x;                  <span class="comment">//更新重心的结点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-高级数据结构："><a href="#2-高级数据结构：" class="headerlink" title="$2.$ 高级数据结构："></a>$2.$ 高级数据结构：</h2><h3 id="2-1-树状数组："><a href="#2-1-树状数组：" class="headerlink" title="$2.1$ 树状数组："></a>$2.1$ 树状数组：</h3><h4 id="2-1-1-单点修改："><a href="#2-1-1-单点修改：" class="headerlink" title="$2.1.1$ 单点修改："></a>$2.1.1$ 单点修改：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(x&lt;=n)&#123;</span><br><span class="line">        sum[x]+=k;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-2-单点查询："><a href="#2-1-2-单点查询：" class="headerlink" title="$2.1.2$ 单点查询："></a>$2.1.2$ 单点查询：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        ans+=sum[x];</span><br><span class="line">        x-=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-3-区间查询："><a href="#2-1-3-区间查询：" class="headerlink" title="$2.1.3$ 区间查询："></a>$2.1.3$ 区间查询：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">        ans+=sum[x];</span><br><span class="line">        l-=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-4-区间修改：-差分"><a href="#2-1-4-区间修改：-差分" class="headerlink" title="$2.1.4$ 区间修改：(差分)"></a>$2.1.4$ 区间修改：(差分)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(x&lt;=n)&#123;</span><br><span class="line">        sum[x]+=k;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    add(l,k);</span><br><span class="line">    add(r+<span class="number">1</span>,-k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-5-求逆序对：-注意离散化"><a href="#2-1-5-求逆序对：-注意离散化" class="headerlink" title="$2.1.5$ 求逆序对：(注意离散化)"></a>$2.1.5$ 求逆序对：(注意离散化)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(x&lt;=n)&#123;</span><br><span class="line">        sum[x]+=k;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        ans+=sum[x];</span><br><span class="line">        x-=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ni</span><span class="params">(<span class="keyword">int</span> a[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) b[i]=a[i];</span><br><span class="line">    sort(b+<span class="number">1</span>,b+n+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        a[i]=lower_bound(b+<span class="number">1</span>,b+n+<span class="number">1</span>,a[i])-b;</span><br><span class="line">        add(a[i]);</span><br><span class="line">        ans+=i-ask(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-6-二维树状数组：-二维差分"><a href="#2-1-6-二维树状数组：-二维差分" class="headerlink" title="$2.1.6$ 二维树状数组：(二维差分)"></a>$2.1.6$ 二维树状数组：(二维差分)</h4><p>略。</p>
<h3 id="2-2-线段树："><a href="#2-2-线段树：" class="headerlink" title="$2.2$ 线段树："></a>$2.2$ 线段树：</h3><p>看题意来写。</p>
<p>一般先宏定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson l,m,root&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson m+1,l,root&lt;&lt;1|1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> con 1,n,1</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-建树："><a href="#2-2-1-建树：" class="headerlink" title="$2.2.1$ 建树："></a>$2.2.1$ 建树：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        sum[root]=a[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(lson),build(rson);</span><br><span class="line">    pushup(root);</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line">build(con);</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-单点修改："><a href="#2-2-2-单点修改：" class="headerlink" title="$2.2.2$ 单点修改："></a>$2.2.2$ 单点修改：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    sum[root]=sum[root&lt;&lt;<span class="number">1</span>]+sum[root&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> k,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        sum[root]+=k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;m) add(x,k,lson);</span><br><span class="line">    <span class="keyword">else</span> add(x,k,rson);</span><br><span class="line">    pushup(root);</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line">add(x,k,con);</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-单点查询："><a href="#2-2-3-单点查询：" class="headerlink" title="$2.2.3$ 单点查询："></a>$2.2.3$ 单点查询：</h4><p>在区间查询的基础上，传两个相同的参即可。</p>
<h4 id="2-2-4-区间修改："><a href="#2-2-4-区间修改：" class="headerlink" title="$2.2.4$ 区间修改："></a>$2.2.4$ 区间修改：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(change[root])&#123;</span><br><span class="line">        sum[root&lt;&lt;<span class="number">1</span>]+=change[root]*l;</span><br><span class="line">        sum[root&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=change[root]*r;</span><br><span class="line">        change[root&lt;&lt;<span class="number">1</span>]+=change[root];</span><br><span class="line">        change[root&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=change[root];</span><br><span class="line">        change[root]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> e,<span class="keyword">int</span> k,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s&lt;=l&amp;&amp;e&gt;=r)&#123;</span><br><span class="line">        sum[root]=sum[root]+(r-l+<span class="number">1</span>)*k;</span><br><span class="line">        change[root]=change[root]+k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    pushdown(root,m-l+<span class="number">1</span>,r-m);</span><br><span class="line">    <span class="keyword">if</span>(s&lt;=m) add(s,e,k,lson);</span><br><span class="line">    <span class="keyword">if</span>(e&gt;m) add(s,e,k,rson);</span><br><span class="line">    pushup(root);</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line">add(s,e,k,son);</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h4 id="2-2-5-区间查询："><a href="#2-2-5-区间查询：" class="headerlink" title="$2.2.5$ 区间查询："></a>$2.2.5$ 区间查询：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(change[root])&#123;</span><br><span class="line">        change[root&lt;&lt;<span class="number">1</span>]+=change[root];</span><br><span class="line">        change[root&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=change[root];</span><br><span class="line">        sum[root&lt;&lt;<span class="number">1</span>]+=change[root]*l;</span><br><span class="line">        sum[root&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=change[root]*r;</span><br><span class="line">        change[root]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> e,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s&lt;=l&amp;&amp;e&gt;=r)&#123;</span><br><span class="line">        <span class="keyword">return</span> sum[root];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    pushdown(root,m-l+<span class="number">1</span>,r-m);</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s&lt;=m) ans+=ask(s,e,lson);</span><br><span class="line">    <span class="keyword">if</span>(e&gt;m) ans+=ask(s,e,rson);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-6-RMQ-：-区间最大值"><a href="#2-2-6-RMQ-：-区间最大值" class="headerlink" title="$2.2.6$ $RMQ$：(区间最大值)"></a>$2.2.6$ $RMQ$：(区间最大值)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> e,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s&lt;=l&amp;&amp;e&gt;=r)&#123;</span><br><span class="line">        <span class="keyword">return</span> sum[root];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> maxx=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(s&lt;=m) maxx=max(maxx,ask(s,e,lson));</span><br><span class="line">    <span class="keyword">else</span> maxx=max(maxx,ask(s,e,rson));</span><br><span class="line">    <span class="keyword">return</span> maxx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-7-其他操作："><a href="#2-2-7-其他操作：" class="headerlink" title="$2.2.7$ 其他操作："></a>$2.2.7$ 其他操作：</h4><p>稍微变一下即可。</p>
<h3 id="2-3-平衡树："><a href="#2-3-平衡树：" class="headerlink" title="$2.3$ 平衡树："></a>$2.3$ 平衡树：</h3><h4 id="2-3-1-普通-treap-："><a href="#2-3-1-普通-treap-：" class="headerlink" title="$2.3.1$ 普通 $treap$："></a>$2.3.1$ 普通 $treap$：</h4><h4 id="2-3-2-fhq-Treap-：-非旋-treap-，合并时应当按照分裂的顺序"><a href="#2-3-2-fhq-Treap-：-非旋-treap-，合并时应当按照分裂的顺序" class="headerlink" title="$2.3.2$ $fhq$_$Treap$：(非旋 $treap$ ，合并时应当按照分裂的顺序)"></a>$2.3.2$ $fhq$_$Treap$：(非旋 $treap$ ，合并时应当按照分裂的顺序)</h4><p>这样存：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ada</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l,r;</span><br><span class="line">    <span class="keyword">int</span> dat,val;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">&#125;t[<span class="number">1000000</span>];</span><br><span class="line"><span class="keyword">int</span> tot,root;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-1-新建结点："><a href="#2-3-2-1-新建结点：" class="headerlink" title="$2.3.2.1$ 新建结点："></a>$2.3.2.1$ 新建结点：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-2-插入："><a href="#2-3-2-2-插入：" class="headerlink" title="$2.3.2.2$ 插入："></a>$2.3.2.2$ 插入：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    split(root,k,x,y);</span><br><span class="line">    root=merge(x,merge(new_node(k),y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-3-删除："><a href="#2-3-2-3-删除：" class="headerlink" title="$2.3.2.3$ 删除："></a>$2.3.2.3$ 删除：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y,z;</span><br><span class="line">    split(root,k,x,y);</span><br><span class="line">    split(x,k<span class="number">-1</span>,x,z);</span><br><span class="line">    z=merge(t[z].l,t[z].r);</span><br><span class="line">    root=merge(merge(x,z),y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-4-分裂："><a href="#2-3-2-4-分裂：" class="headerlink" title="$2.3.2.4$ 分裂："></a>$2.3.2.4$ 分裂：</h5><h6 id="2-3-2-4-1-按权值分裂：-将小于等于-k-和大于-k-的结点分裂开来"><a href="#2-3-2-4-1-按权值分裂：-将小于等于-k-和大于-k-的结点分裂开来" class="headerlink" title="$2.3.2.4.1$ 按权值分裂：(将小于等于 $k$ 和大于 $k$ 的结点分裂开来)"></a>$2.3.2.4.1$ 按权值分裂：(将小于等于 $k$ 和大于 $k$ 的结点分裂开来)</h6><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    t[root].size=t[t[root].l].size+t[t[root].r].size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> k,<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> &amp;y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(now==<span class="number">0</span>) x=y=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(t[now].val&lt;=k)&#123;</span><br><span class="line">        x=now;</span><br><span class="line">        split(t[now].r,k,t[now].r,y);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        y=now;</span><br><span class="line">       	split(t[now].l,k,x,t[now].l);</span><br><span class="line">    &#125;</span><br><span class="line">    updata(now);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="2-3-2-4-2-按秩分裂：-将前k个和其他分裂"><a href="#2-3-2-4-2-按秩分裂：-将前k个和其他分裂" class="headerlink" title="$2.3.2.4.2$ 按秩分裂：(将前k个和其他分裂)"></a>$2.3.2.4.2$ 按秩分裂：(将前k个和其他分裂)</h6><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    t[root].size=t[t[root].l].size+t[t[root].r].size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> k,<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> &amp;y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(now==<span class="number">0</span>) x=y=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(k&lt;=t[t[now].l].size)&#123;</span><br><span class="line">        y=now;</span><br><span class="line">        split(t[now].l,k,x,t[now].l);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        x=now;</span><br><span class="line">        split(t[now].r,k-t[t[now].l].size<span class="number">-1</span>,t[now].r,y);</span><br><span class="line">    &#125;</span><br><span class="line">    updata(now);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-5-合并："><a href="#2-3-2-5-合并：" class="headerlink" title="$2.3.2.5$ 合并："></a>$2.3.2.5$ 合并：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!a||!b) <span class="keyword">return</span> a+b;</span><br><span class="line">    <span class="keyword">if</span>(t[a].dat&lt;t[b].dat)&#123;</span><br><span class="line">        t[a].r=merge(t[a].r,b);</span><br><span class="line">        updata(a);</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        t[b].l=merge(a,t[b].l);</span><br><span class="line">        updata(b);</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-2-6-用权值查询排名："><a href="#2-3-2-6-用权值查询排名：" class="headerlink" title="$2.3.2.6$ 用权值查询排名："></a>$2.3.2.6$ 用权值查询排名：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">val_rank</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    split(root,k<span class="number">-1</span>,x,y);</span><br><span class="line">    <span class="keyword">int</span> res=t[x].size+<span class="number">1</span>;</span><br><span class="line">    root=merge(x,y);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-7-用排名查询权值："><a href="#2-3-2-7-用排名查询权值：" class="headerlink" title="$2.3.2.7$ 用排名查询权值："></a>$2.3.2.7$ 用排名查询权值：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rank_val</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t[t[root].l].size==k<span class="number">-1</span>) <span class="keyword">return</span> t[root].val;</span><br><span class="line">    <span class="keyword">if</span>(t[t[root].l].size&gt;=k) <span class="keyword">return</span> rank_val(t[root.l],k);</span><br><span class="line">    <span class="keyword">return</span> rank_val(t[root].r,k-t[t[root].l].size<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-8-求前驱："><a href="#2-3-2-8-求前驱：" class="headerlink" title="$2.3.2.8$ 求前驱："></a>$2.3.2.8$ 求前驱：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    split(root,k<span class="number">-1</span>,x,y);</span><br><span class="line">    <span class="keyword">int</span> res=rank_val(x,t[x].size);</span><br><span class="line">    root=merge(x,y);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-9-求后继："><a href="#2-3-2-9-求后继：" class="headerlink" title="$2.3.2.9$ 求后继："></a>$2.3.2.9$ 求后继：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nex</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    split(root,k,x,y);</span><br><span class="line">    <span class="keyword">int</span> res=rank_val(y,<span class="number">1</span>);</span><br><span class="line">    root=merge(x,y);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-10-区间操作："><a href="#2-3-2-10-区间操作：" class="headerlink" title="$2.3.2.10$ 区间操作："></a>$2.3.2.10$ 区间操作：</h5><p>将此段区间分裂出来，单独处理，再合并回去。这里注意<strong>当把整个序列按此区间某端点分裂成两半时，此区间另一端点的位置已经改变了。</strong></p>
<h4 id="2-3-3-splay-："><a href="#2-3-3-splay-：" class="headerlink" title="$2.3.3$ $splay$："></a>$2.3.3$ $splay$：</h4><p>没学，算了。</p>
<h3 id="2-4-树链剖分：-一般使用线段树维护区间"><a href="#2-4-树链剖分：-一般使用线段树维护区间" class="headerlink" title="$2.4$ 树链剖分：(一般使用线段树维护区间)"></a>$2.4$ 树链剖分：(一般使用线段树维护区间)</h3><h5 id="2-4-1-第一遍-dfs-：-处理深度，父节点，重儿子"><a href="#2-4-1-第一遍-dfs-：-处理深度，父节点，重儿子" class="headerlink" title="$2.4.1$ 第一遍 $dfs$ ：(处理深度，父节点，重儿子)"></a>$2.4.1$ 第一遍 $dfs$ ：(处理深度，父节点，重儿子)</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> f,<span class="keyword">int</span> dep)</span></span>&#123;</span><br><span class="line">    t[x].deep=dep;</span><br><span class="line">    t[x].size=<span class="number">1</span>;</span><br><span class="line">    t[x].fa=f;</span><br><span class="line">    <span class="keyword">int</span> maxx=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[x];i;i=t[i].nex)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=t[i].to;</span><br><span class="line">        <span class="keyword">if</span>(v==f) <span class="keyword">continue</span>;</span><br><span class="line">        dfs1(v,x,dep+<span class="number">1</span>);</span><br><span class="line">        size[x]+=size[v];</span><br><span class="line">        <span class="keyword">if</span>(maxx&lt;size[v]) maxx=size[v],t[x].son=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-2-第二遍-dfs-：-处理编号，每条链的头头"><a href="#2-4-2-第二遍-dfs-：-处理编号，每条链的头头" class="headerlink" title="$2.4.2$ 第二遍 $dfs$ ：(处理编号，每条链的头头)"></a>$2.4.2$ 第二遍 $dfs$ ：(处理编号，每条链的头头)</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> tt)</span></span>&#123;</span><br><span class="line">    t[x].id=++cnt;</span><br><span class="line">    t[x].top=tt;</span><br><span class="line">    t[cnt].val=w[x];                       <span class="comment">//w存输入的价值</span></span><br><span class="line">    <span class="keyword">if</span>(!t[x].son) <span class="keyword">return</span>;</span><br><span class="line">    dfs(t[x].son,tt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[x];i;i=t[i].nex)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=t[i].to;</span><br><span class="line">        <span class="keyword">if</span>(v==t[i].son||v=t[i].fa) <span class="keyword">continue</span>;</span><br><span class="line">		dfs2(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-3-树上路径查询："><a href="#2-4-3-树上路径查询：" class="headerlink" title="$2.4.3$ 树上路径查询："></a>$2.4.3$ 树上路径查询：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask_qujian</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(t[l].top!=t[r].top)&#123;</span><br><span class="line">        <span class="keyword">if</span>(t[t[l].top].deep&lt;t[t[r].top].deep) swap(l,r);</span><br><span class="line">        res+=ask(t[t[l].top].id,t[l].id,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        l=t[t[l].top].fa;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t[l].deep&gt;t[r].deep) swap(l,r);</span><br><span class="line">    res+=ask(t[l].id,t[r].id,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-4-树上点查询："><a href="#2-4-4-树上点查询：" class="headerlink" title="$2.4.4$ 树上点查询："></a>$2.4.4$ 树上点查询：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask_dian</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ask(t[x].id,t[x].size+t[x].id+<span class="number">1</span>,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-5-树上路径修改："><a href="#2-4-5-树上路径修改：" class="headerlink" title="$2.4.5$ 树上路径修改："></a>$2.4.5$ 树上路径修改：</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change_qujian</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(t[l].top!=t[r].top)&#123;</span><br><span class="line">        <span class="keyword">if</span>(t[t[l].top].deep&lt;t[t[r].top].deep) swap(l,r);</span><br><span class="line">        change(t[t[l].top].id,t[l].id,k,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        l=t[t[l].top].fa;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t[l].deep&gt;t[r].deep) swap(l,r);</span><br><span class="line">    change(t[l].id,t[r].id,k,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-6-其他操作："><a href="#2-4-6-其他操作：" class="headerlink" title="$2.4.6$ 其他操作："></a>$2.4.6$ 其他操作：</h5><p>如果是改变边权，在第一遍 $dfs$ 时下放到点权即可。</p>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/模板/">#模板</a>
        </div>
    

    <!-- Comments -->
    
    <div class="comments">
        
<div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



<div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



    </div>
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    All the teenagers have dreams in China,unite!
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2020/06/07/欢迎来到我的博客/">欢迎来到我的博客</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/11/11/AFO感言/">AFO感言</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/11/07/最后的板子——基础篇/">最后的板子——基础篇</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/11/07/最后的板子——动态规划篇/">最后的板子——动态规划篇</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:enstein.ei@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                     CC0 To the extent possible under law, Enstein has waived all copyright and related or neighboring rights to Enstein'Blog. This work is published from: China 
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'enstein';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

</html>